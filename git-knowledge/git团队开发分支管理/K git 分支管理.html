<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.11 (454874)"/><meta name="altitude" content="6.149927139282227"/><meta name="author" content="alanfujindong@gmail.com"/><meta name="created" content="2017-05-05 00:42:19 +0000"/><meta name="latitude" content="31.88608999929387"/><meta name="longitude" content="120.5232958427527"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-05-05 08:01:41 +0000"/><title>K git 分支管理</title></head><body><div>指令：</div><div><ul><li>git branch 查看分支</li><li>git branch &lt;name&gt; 创建分支</li><li>git checkout &lt;name&gt; 切换分支</li><li>git checkout -b &lt;name&gt; 创建+切换分支</li><li>git merge &lt;name&gt; 合并某分支到当前分支</li><li>git branch -d &lt;name&gt; 删除分支</li><li>git branch -D &lt;name&gt; 删除分支在没有合并分支的情况下</li></ul><div><br/></div></div><ul><li>git log --graph --pretty=oneline --abbrev-commit  以图表的形式查看分支线</li><li>git merge —no-ff -m “提交备注” &lt;需合并的分支名&gt;</li></ul><div/><div><br/></div><ul><li>git add A/*  添加文件夹</li></ul><div><br/></div><div><ul><li>git stash 将工作区修改的内容存储起来 显示为原先未修改的状态</li><li>git stash list  查看stash 存储的内容</li><li>git stash apply stash@{0} 恢复</li><li>git stash drop stash@{0} 删除</li><li>git stash pop 恢复的时候同时将stash内容删除</li></ul><div><br/></div></div><ul><li>git push origin &lt;name&gt; 将该分支推送到远程分支</li><li>git checkout -b &lt;branch-name&gt; origin/&lt;name&gt; 创建于远程分支相关联的分支</li><li>git pull 把远程仓库的内容抓到本地 分支的不同获取的内容也不同</li><li>git branch —set-upstream &lt;branch-name&gt; origin/&lt;name&gt; 指定本地分支与远程分支链接</li><li>git branch --set-upstream-to=origin/&lt;branch&gt; &lt;branch-name&gt; 指定本地分支与远程分支链接</li></ul><div><ul/></div><div/><div/><div><br/></div><div>一般合并会提示 Fast-forward “快进合并” 就是直接把master指向dev的当前提交。</div><div><br/></div><div><div><font style="font-size: 18px;">合并冲突</font><br/></div><hr/><ol/></div><div>当两个分支中同一处被修改，在合并的时候就会引起冲突，git 会在文件中用&lt;&lt;&lt;&lt;&lt;&lt;,=======,&gt;&gt;&gt;&gt;&gt;&gt;标出不同文件的分支内容，修改后保存提交即可。</div><div>用带参数的 git log 可以查看分支的合并情况</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git log --graph --pretty=oneline --abbrev-commit<br/></div></div><div><img src="K%20git%20%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86.resources/skitch_1.png" height="260" width="1152"/><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 18px;">分支管理策略</font></div><hr/><div><br/></div><div><div><ul><li>禁用Fast-forward</li></ul></div><ol/></div><div><span>    <span>    </span></span>在合并的时候使用 Fast-forward 模式时，删除分支后会丢掉分支信息。</div><div><span>    <span>    </span></span>如果强制禁用Fast-forward模式，Git就会在merge时生成一个新的commit，这样从分支历史上就可以看出分支信息。</div><div>操作：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git merge —no-ff -m “提交备注” &lt;分支名&gt;</div><div><br/></div><div>-m 合并的时候创建一个新的commit</div></div><div><img src="K%20git%20%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86.resources/skitch_2.png" height="622" width="1140"/><br/></div><div><br/></div><div><i style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span>    <span>    </span></span>具体原因是采用Fast-forward 模式时 是将master 指针直接指向dev分支的最新提交，并且commit ID 也是一样的 所以dev的分支信息就会丢掉；而采用--no-ff 模式，在合并的时候进行了一次 git commit 合并操作，commit id 也会不同，在分支历史上就能看到信息。</i></div><div><i style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></i></div><ul><li>分支策略</li></ul><div><br/></div><div>        <img src="K%20git%20%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86.resources/E30861DE-B5B7-4F24-93BF-65275469975F.png" height="125" width="498"/></div><i style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"/><div><i style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></i></div><div>在实际开发中，按照上面的分支策略图进行分支管理：</div><div>首先，master分支仅用来发布新版本，不能在上面干活。</div><div>Dev分支是测试工作的主分支，如果要发布一个版本 ，将dev合并到master就可以了。</div><div>开发的小伙伴们基于dev分支 分出自己的分支，时不时往dev分支合并就可以了。</div><div><i style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></i></div><div><font style="font-size: 18px;">bug分支</font></div><div><hr/></div><div>  情境：<br/></div><div><span>    <span>    当你正在dev上开发一个任务，需要两天才能完成，但是现在接到一个bug需要马上修复，但是工作区（开发的代码）才完成了一半，还没法提交，怎么办呢。</span></span><br/></div><div>Git提供了一个stash功能，可以把当前工作区的内容存起来，等以后恢复继续工作。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git stash    将当前工作区修改的内容存储起来并恢复修改之前的状态</div></div><div>然后可以切到master修改bug</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span>$ git checkout -b issue-101</span></div><div><span>Switched to a new branch 'issue-101'</span></div></div><div>修改完提交</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git add .</div><div><span>$ git commit -m "fix bug 101"</span></div><div><span>[issue-101 df0195f] fix bug 101</span></div></div><div>切换主分支进行合并</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git checkout master</div><div>$ git merge --no-ff -m "merge bug fix 101" issue-101</div><div>$ git branch -d issue-101</div></div><div>bug 修改完 到dev分支先进行改完bug的master 与当前dev的合并</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git checkout dev</div><div>$ git merge --no-ff -m "dev-merge-m" master</div></div><div>然后释放之前存储的内容</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span>git stash list</span></div><div><span>stash@{0}: WIP on dev: 8190e93 add dev</span></div><div>$ git stash pop</div><div><span>Auto-merging </span><a href="http://readme.md">readme.md</a></div><div><span>On branch dev</span></div></div><div>为什么要有这个存储功能，个人理解，如果在dev的分支中任务未完成 然后切到别的分支 你修改的内容在工作区还是会显示的。当然有人说可以将dev中的修改先提交了。这样不是不可以。严格意义上将提交代表你的代码已经完成了可以上传提交了。</div><div>所以用stash还是比较方便的 也可以在开发的不同阶段进行多次stash </div><div><br/></div><div><br/></div><div><br/></div><div><font style="font-size: 18px;">多人协作</font></div><div><hr/></div><div>这里用Github 搭建远程仓库为例：</div><div>在github上新建一个仓库</div><div>然后将本地仓库与之关联</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git remote add origin <a>git@github.com:******</a></div><div>$ git push -u origin master</div></div><div><br/></div><div>然后在GitHub中点击仓库的settings 在Options 中点击Collaborators </div><div><img src="K%20git%20%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86.resources/skitch.png" height="436" width="1426"/><br/></div><div>然后在搜索框中输入你要邀请的小伙伴的名字或者邮箱，然后等待小伙伴的同意，也可以直接将邀请链接直接发给小伙伴</div><div>小伙伴直接在本地新建仓库并克隆GitHub上的内容</div><div>小伙伴可以创建一个dev分支并上传到远程服务器上</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git checkout -b dev</div><div>//添加一些内容</div><div>$ git add .</div><div>$ git commit -m “add dev”</div><div>$ git push origin dev</div></div><div><br/></div><div>现在小伙伴已经在远程仓库创建了一个分支</div><div>然后我在我本地的仓库执行如下：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git pull</div><div>remote: Counting objects: 3, done.</div><div>remote: Compressing objects: 100% (3/3), done.</div><div>remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</div><div>Unpacking objects: 100% (3/3), done.</div><div>From https://github.com/**********</div><div> * [new branch]      dev        -&gt; origin/dev</div><div>Already up-to-date.</div><div>//会发现有一个新的分支</div></div><div>接着执行</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git branch</div><div>* master</div></div><div>看不到dev 分支，需要在本地创建一个与远程仓库对应的分支，</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git checkout -b dev origin/dev</div><div>M       .idea/misc.xml</div><div>Branch dev set up to track remote branch dev from origin.</div><div>Switched to a new branch ‘dev'</div><div>$ git branch</div><div>* dev</div><div>  master</div></div><div>然后我创建一些内容提交 没有什么问题</div><div>接着小伙伴去dev分支上执行 git pull 抓取我刚刚提交的内容出现如下问题</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>$ git pull</div><div>remote: Counting objects: 5, done.</div><div>remote: Compressing objects: 100% (1/1), done.</div><div>remote: Total 5 (delta 4), reused 5 (delta 4), pack-reused 0</div><div>Unpacking objects: 100% (5/5), done.</div><div>From <a href="https://github.com/ScottFJD/BrightBook">https://github.com/</a>*****</div><div>   0008c75..681dcf0  dev        -&gt; origin/dev</div><div>There is no tracking information for the current branch.</div><div>Please specify which branch you want to merge with.</div><div>See git-pull(1) for details.    </div><div>git pull &lt;remote&gt; &lt;branch&gt;</div><div>If you wish to set tracking information for this branch you can do so with:    </div><div>git branch --set-upstream-to=origin/&lt;branch&gt; dev<br/></div></div><div>根据提示执行 $git branch --set-upstream-to=origin/dev dev 使本地分支与远程分支链接</div><div>Branch dev set up to track remote branch dev from origin.<br/></div><div><br/></div></body></html>